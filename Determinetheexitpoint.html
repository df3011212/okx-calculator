<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡Œç›®ç·¨è¼¯å™¨ & è§£é¡Œç³»çµ±</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 0 1rem;
      color: #333;
    }
    h1 {
      text-align: center;
      font-size: 1.75rem;
      margin: 1.5rem 0;
    }
    .card {
      background-color: #fff;
      border-radius: 1rem;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .question-title {
      font-weight: bold;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .options label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1rem;
      background: #eef2f7;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid #ccc;
    }
    .options input[type="radio"],
    .options input[type="checkbox"] {
      width: 1.25rem;
      height: 1.25rem;
    }
    .correct {
      background-color: #e8f5e9;
      border-color: #43a047;
    }
    .incorrect {
      background-color: #fdecea;
      border-color: #e53935;
    }
    .editor-area textarea {
      width: 100%;
      height: 300px;
      font-size: 1rem;
      padding: 1rem;
      border-radius: 0.75rem;
      border: 1px solid #ccc;
      font-family: monospace;
    }
    .hidden {
      display: none;
    }
    .result-box {
      padding: 1rem;
      border-radius: 0.75rem;
      font-weight: bold;
    }
    .result-box.success {
      background: #d4edda;
      color: #155724;
    }
    .result-box.error {
      background: #f8d7da;
      color: #721c24;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .submit-btn {
      background-color: #2563eb;
      color: #fff;
      width: 100%;
    }
    .admin-tools,
    #unlockCard {
      margin-bottom: 1.5rem;
    }
    select,
    input[type="text"],
    input[type="password"] {
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 1rem;
      width: auto;
    }
    .delete-btn {
      background-color: #dc3545;
      color: white;
      padding: 0.25rem 0.75rem;
      font-size: 0.9rem;
      float: right;
      border-radius: 0.5rem;
    }
    @media (min-width: 768px) {
      body {
        padding: 1.5rem 2rem;
      }
      .card {
        max-width: 720px;
        margin-left: auto;
        margin-right: auto;
      }
      .submit-btn {
        max-width: 720px;
        margin: 0 auto;
        display: block;
      }
    }
    .editor-area textarea {
  width: 100%;
  height: 300px;
  font-size: 1rem;
  padding: 1rem;
  border-radius: 0.75rem;
  border: 1px solid #ccc;
  font-family: monospace;
}
.hidden {
  display: none;
}
button {
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  border: none;
  border-radius: 0.75rem;
  cursor: pointer;
  margin-top: 0.5rem;
}
.submit-btn {
  background-color: #2563eb;
  color: #fff;
  width: 100%;
}
.admin-tools,
#unlockCard {
  margin-bottom: 1.5rem;
}
select,
input[type="text"],
input[type="password"] {
  padding: 0.5rem;
  border-radius: 0.5rem;
  border: 1px solid #ccc;
  font-size: 1rem;
  width: auto;
}
.delete-btn {
  background-color: #dc3545;
  color: white;
  padding: 0.25rem 0.75rem;
  font-size: 0.9rem;
  float: right;
  border-radius: 0.5rem;
}
@media (min-width: 768px) {
  body {
    padding: 1.5rem 2rem;
  }
  .card {
    max-width: 720px;
    margin-left: auto;
    margin-right: auto;
  }
  .submit-btn {
    max-width: 720px;
    margin: 0 auto;
    display: block;
  }
}

  </style>
</head>
<body>

<h1>ğŸ§  é¡Œç›®ç·¨è¼¯å™¨ & è§£é¡Œç³»çµ±</h1>

<div class="card admin-tools" id="adminPanel" style="display:none">
  <h2>â• é¡Œç›®ç®¡ç†å·¥å…·</h2>
  <label>æ–°å¢é¡Œç›®é¡å‹ï¼š
    <select id="newType">
      <option value="single">å–®é¸é¡Œ</option>
      <option value="multiple">å¤šé¸é¡Œ</option>
    </select>
  </label>
  <button onclick="addQuestion()">æ–°å¢é¡Œç›®</button>
  <button onclick="logout()">ğŸšª ç™»å‡º</button>
</div>

<!-- å¯†ç¢¼é©—è­‰å€ -->
<div class="card" id="unlockCard">
  <h2>ğŸ” è«‹è¼¸å…¥å¯†ç¢¼ä»¥ç·¨è¼¯é¡Œç›®</h2>
  <input type="password" id="passwordInput" placeholder="è¼¸å…¥å¯†ç¢¼">
  <button onclick="unlockEditor()">è§£é–</button>
</div>

<!-- é¡Œç›®ç·¨è¼¯å€ -->
<div class="card editor-area hidden" id="editorCard">
  <h2>âœï¸ ç·¨è¼¯é¡Œç›®ï¼ˆJSON æ ¼å¼ï¼‰</h2>
  <textarea id="editor"></textarea>
  <button onclick="renderQuestions()">ğŸ”„ é‡æ–°è¼‰å…¥é¡Œç›®</button>
</div>


<!-- é¡Œç›®ç”¢å‡ºå€ -->
<div class="card">
  <h2>ğŸ¯ è«‹é¸æ“‡è¦å‡ºå¹¾é¡Œ</h2>
  <label for="questionCount">é¡Œæ•¸ï¼š</label>
  <select id="questionCount">
    <option value="1">1 é¡Œ</option>
    <option value="2">2 é¡Œ</option>
    <option value="3">3 é¡Œ</option>
    <option value="5">5 é¡Œ</option>
    <option value="10">10 é¡Œ</option>
  </select>
  <button onclick="generateQuestions()">ğŸ² ç”¢ç”Ÿé¡Œç›®</button>
</div>



<!-- è§£é¡Œçµæœæç¤º -->
<div id="result" class="result-box hidden"></div>

<!-- é¡Œç›®å‘ˆç¾å€ -->
<div id="questions"></div>

<!-- é€å‡ºç­”æ¡ˆæŒ‰éˆ• -->
<button class="submit-btn" onclick="submitAnswers()">âœ… é€å‡ºç­”æ¡ˆ</button>

<script>
let questions = [];
let editorUnlocked = false;
let selectedQuestions = [];
const LS_KEY = "question_bank";


function generateQuestions() {
  const count = parseInt(document.getElementById("questionCount").value);
  if (questions.length === 0) {
    alert("é¡Œåº«ç‚ºç©ºï¼Œç„¡æ³•å‡ºé¡Œï¼");
    return;
  }

  if (count > questions.length) {
    alert(`é¡Œåº«åªæœ‰ ${questions.length} é¡Œï¼Œè«‹é¸æ“‡æ›´å°‘çš„é¡Œæ•¸`);
    return;
  }

  // æ´—ç‰Œä¸¦éš¨æ©Ÿå–å‡º count é¡Œ
  selectedQuestions = [...questions].sort(() => Math.random() - 0.5).slice(0, count);
  renderQuestions(selectedQuestions);
}




function getDefaultQuestions() {
  return [
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º SDUï¼Œå“¥å“¥çš„å“¥å“¥ç‚º OWDï¼Œä»»å‹™ç‚ºï¼Ÿ",
      "options": ["Kæ£’æ¼²åˆ°å“¥å“¥çš„å“¥å“¥çš„EMA52", "MACD é»ƒç·šç©¿è¶Š EMA20", "RSI ä¸Šç©¿50"],
      "answer": [0]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º OWDï¼Œä»»å‹™ç‚ºï¼Ÿ",
      "options": ["Kæ£’æ¼²åˆ°å“¥å“¥EMA52", "Kæ£’è·Œç ´å¸ƒæ—é€šé“ä¸‹è»Œ", "å‡ç·šç³¾çµçªç ´"],
      "answer": [0]
    }
  ];
}

function loadFromLocalStorage() {
  const saved = localStorage.getItem(LS_KEY);
  if (saved) {
    try {
      questions = JSON.parse(saved);
      document.getElementById("editor").value = JSON.stringify(questions, null, 2);
    } catch (e) {
      console.warn("localStorage è¼‰å…¥å¤±æ•—ï¼š", e);
    }
  }
}

function saveToLocalStorage() {
  try {
    localStorage.setItem(LS_KEY, document.getElementById("editor").value);
  } catch (e) {
    alert("å„²å­˜å¤±æ•—ï¼");
  }
}

function renderQuestions(data = questions) {
  const container = document.getElementById("questions");
  const raw = document.getElementById("editor").value;
  try {
    questions = JSON.parse(raw);
  } catch(e) {
    alert("JSON æ ¼å¼éŒ¯èª¤ï¼è«‹æª¢æŸ¥ã€‚");
    return;
  }
  container.innerHTML = "";
  data.forEach((q, idx) => {  
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<div class='question-title'>${idx+1}. ${q.question}` +
      (editorUnlocked ? `<button class='delete-btn' onclick='deleteQuestion(${idx})'>åˆªé™¤é¡Œç›®</button>` : "") +
      `</div>` +
      q.options.map((opt, i) => {
        const inputType = q.answer.length > 1 ? "checkbox" : "radio";
        const isCorrect = q.answer.includes(i);
        const styleClass = editorUnlocked && isCorrect ? 'correct' : '';
        return `<label class='${styleClass}'><input type='${inputType}' name='q${idx}' value='${i}'> ${opt}</label>`;
      }).join("");
      (editorUnlocked ? `<button class='delete-btn' onclick='deleteQuestion(${idx})'>åˆªé™¤é¡Œç›®</button>` : "") +
      `</div>` +
      q.options.map((opt, i) => {
        const inputType = q.answer.length > 1 ? "checkbox" : "radio";
        return `<label><input type='${inputType}' name='q${idx}' value='${i}'> ${opt}</label>`;
      }).join("");
    container.appendChild(div);
  });
  document.getElementById("result").classList.add("hidden");
  document.getElementById("editor").value = JSON.stringify(questions, null, 2);
  saveToLocalStorage();
}

function submitAnswers() {
  let allCorrect = true;
  const wrongList = [];
  selectedQuestions.forEach((q, idx) => {
    const selected = Array.from(document.querySelectorAll(`input[name='q${idx}']`))
      .filter(i => i.checked).map(i => parseInt(i.value));
    const correct = q.answer.sort().join(',');
    const given = selected.sort().join(',');
    if (correct !== given) {
      allCorrect = false;
      wrongList.push(idx + 1);
    }
  });
  const resultBox = document.getElementById("result");
  resultBox.classList.remove("hidden", "success", "error");
  window.scrollTo({ top: 0, behavior: 'smooth' });
  if (allCorrect) {
    resultBox.classList.add("success");
    resultBox.innerHTML = "ğŸ‰ å…¨éƒ¨ç­”å°ï¼å¤ªå¼·å•¦ï¼";
  } else {
    resultBox.classList.add("error");
    let detail = wrongList.map(n => `ç¬¬ ${n} é¡Œ`).join("ã€");
    resultBox.innerHTML = `âŒ æœ‰éŒ¯èª¤ï¼š${detail}<br><br>`;
    wrongList.forEach(n => {
      const correctAns = selectedQuestions[n-1].answer
      .slice() // é¿å…ä¿®æ”¹åŸæœ¬æ’åº
      .sort((a, b) => a - b)
      .map(i => selectedQuestions[n-1].options[i])
      .join("ã€");

      resultBox.innerHTML += `âœ… ç¬¬ ${n} é¡Œæ­£ç¢ºç­”æ¡ˆï¼š${correctAns}<br>`;
    });
  }
}

function addQuestion() {
  const type = document.getElementById("newType").value;
  const isMulti = type === "multiple";
  const newQ = {
    question: isMulti ? "è«‹è¼¸å…¥å¤šé¸é¡Œå•é¡Œï¼ˆå¯è¤‡é¸ï¼‰" : "è«‹è¼¸å…¥å–®é¸é¡Œå•é¡Œ",
    options: ["é¸é … A", "é¸é … B", "é¸é … C"],
    answer: isMulti ? [0, 1] : [0]
  };
  try {
    questions = JSON.parse(document.getElementById("editor").value);
  } catch (e) {
    questions = [
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º SDUï¼Œå“¥å“¥çš„å“¥å“¥ç‚º OWDï¼Œä»»å‹™ç‚ºï¼Ÿ",
      "options": ["MACD é»ƒç·šç©¿è¶Š EMA20", "Kæ£’æ¼²åˆ°å“¥å“¥çš„å“¥å“¥çš„EMA52", "RSI ä¸Šç©¿50"],
      "answer": [1]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º OWDï¼Œä»»å‹™ç‚ºï¼Ÿ",
      "options": ["Kæ£’æ¼²åˆ°å“¥å“¥EMA52", "Kæ£’è·Œç ´å¸ƒæ—é€šé“ä¸‹è»Œ", "å‡ç·šç³¾çµçªç ´"],
      "answer": [0]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º WDUï¼Œä»»å‹™ç‚ºï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰",
      "options": ["å“¥å“¥ MACD è—ç·šå›åˆ°0è»¸", "Kæ£’å›åˆ°å“¥å“¥ EMA52", "Kæ£’æ¼²åˆ°å“¥å“¥çš„å“¥å“¥çš„EMA52"],
      "answer": [0, 1]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º SDUï¼Œå“¥å“¥ç‚º 1STMï¼Œä»»å‹™ç‚ºï¼Ÿ",
      "options": ["Kæ£’å›åˆ°æ–¹å‘çš„ EMA52", "Kæ£’è·Œç ´æ–¹å‘çš„ EMA52", "RSI ä¸Šç©¿50"],
      "answer": [0]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º WDUï¼Œå“¥å“¥ç‚º OWDï¼Œä»»å‹™ç‚ºï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰",
      "options": ["æ–¹å‘ MACD è—ç·šå›åˆ°0è»¸", "Kæ£’å›åˆ°æ–¹å‘çš„ EMA52", "æ­¤é¸é …ç‚ºå¹²æ“¾é …"],
      "answer": [0, 1]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º WDUï¼Œå“¥å“¥ç‚º OWUï¼Œä»»å‹™ç‚ºï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰",
      "options": ["æ–¹å‘ MACD è—ç·šå›åˆ°0è»¸", "Kæ£’å›åˆ°æ–¹å‘çš„ EMA52", "Kæ£’è§¸åŠé€±æœŸé«˜é»"],
      "answer": [0, 1]
    },
    {
      "question": "å¼Ÿå¼Ÿç‚º SDUï¼Œæ–¹å‘ç‚º WDUï¼Œå“¥å“¥ç‚º 1STMï¼Œä»»å‹™ç‚ºï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰",
      "options": ["æ–¹å‘ MACD è—ç·šå›åˆ°0è»¸", "Kæ£’å›åˆ°æ–¹å‘çš„ EMA52", "Kæ£’è·Œç ´æ˜¨æ—¥ä½é»"],
      "answer": [0, 1]
    }
  ];
  }
  questions.push(newQ);
  document.getElementById("editor").value = JSON.stringify(questions, null, 2);
  renderQuestions();
}

function deleteQuestion(index) {
  if (confirm("ç¢ºå®šè¦åˆªé™¤ç¬¬ " + (index + 1) + " é¡Œå—ï¼Ÿ")) {
    questions.splice(index, 1);
    document.getElementById("editor").value = JSON.stringify(questions, null, 2);
    renderQuestions();
  }
}

function unlockEditor() {
  const input = document.getElementById("passwordInput").value;
  const encoded = btoa(input);
  if (encoded === "MDUwOA==") {
    editorUnlocked = true;
    document.getElementById("unlockCard").classList.add("hidden");
    document.getElementById("editorCard").classList.remove("hidden");
    document.getElementById("adminPanel").style.display = "block";
    renderQuestions();
  } else {
    alert("å¯†ç¢¼éŒ¯èª¤ï¼");
  }
}

function logout() {
  editorUnlocked = false;
  document.getElementById("editorCard").classList.add("hidden");
  document.getElementById("adminPanel").style.display = "none";
  document.getElementById("unlockCard").classList.remove("hidden");
  renderQuestions();
}

questions = [];
loadFromLocalStorage();
if (!questions.length) {
  questions = getDefaultQuestions();
  document.getElementById("editor").value = JSON.stringify(questions, null, 2);
}
renderQuestions();
</script>

</body>
</html>
